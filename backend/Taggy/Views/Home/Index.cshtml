<div class="panel panel-info">
	<div class="panel-heading">
		<h3 class="panel-title">Введите изображение с ценником</h3>
	</div>
	<div class="panel-body">
    	<form class="form" method="post" style="text-align: center;" enctype="multipart/form-data">
			<input type="file" id="file" name="file"/>
			<span class="percent2"></span>
			<div class="progress2" style="background:#B4F5B4;height:20px;border-radius:3px;width: 0"></div>
		</form>	
  	</div>
</div>

<div id="results-panel" class="panel panel-success">
	<div class="panel-heading">
		<h3 class="panel-title">Результат</h3>
	</div>
	<div id="results" class="panel-body">
		<p id="price"></p>
		<p id="pos1"></p>
		<p id="pos2"></p>
		<p>Your ip: <span id="ip-addr"></span></p>
		<p>Your country: <span id="country"></span></p>
		<img id="image" class="img-responsive" /><br/>
    	<pre id="message"></pre>
  	</div>
</div>

@section scripts {
  	<script>
  	if(navigator.geolocation) {
			    		navigator.geolocation.getCurrentPosition(function(position) {
			            var latitude = position.coords.latitude;
			            var longitude = position.coords.longitude;
			            obj.position[0] = latitude;
			            obj.position[1] = longitude;
			        	});
			     		}
					}
  	</script>

	<script>
	$("#results-panel").hide();
	$("#file").on("change", function (event) {
		var t = event.target.files[0];
		prj1551.imageResizer.resize({
			file: t,
			maxWidth: 650,
			maxHeight: 650,
			complete: function (result) {
				$("#image").attr("src", "data:image/jpeg;base64" + result.data);
				$("#results-panel").show();
				prj1551.imageResizer.upload({
					url: 'Convert',
					data: result.data,
					mimeType: t.type,
					fileName: t.name,
					formDataName: 'file',
					progressIndicator: '.progress2',
					percentIndicator: '.percent2',
					success: function(data) {
						$('.progress2').hide();
						$('.percent2').hide();
						var obj = jQuery.parseJSON(this.response);
						$('#price').html(obj.price);
						$('#message').html(obj.message);
						$('#ip-addr').html(obj.ip);
						$('#country').html(obj.country);
					
						$('#pos1').html(obj.position[0]);
						$('#pos2').html(obj.position[1]);

						if (obj.ok) {
							$('#price').show();
							$('#message').hide();
							$('#pos1').show();
							$('#pos2').show();
						} else {
							$('#price').hide();
							$('#message').show();
						}

				});
			}
		});
	});
	</script>
}