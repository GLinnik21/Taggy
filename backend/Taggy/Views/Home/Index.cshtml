<div class="panel panel-info">
	<div class="panel-heading">
		<h3 class="panel-title">Введите изображение с ценником</h3>
	</div>
	<div class="panel-body">
    	<form class="form" method="post" style="text-align: center;" enctype="multipart/form-data">
			<input type="file" id="file" name="file"/>
			<span class="percent2"></span>
			<div class="progress2" style="background:#B4F5B4;height:20px;border-radius:3px;width: 0"></div>
		</form>	
  	</div>
</div>

<div id="results-panel" class="panel panel-success">
	<div class="panel-heading">
		<h3 class="panel-title">Результат</h3>
	</div>
	<div id="results" class="panel-body">
		<p id="price"> </p>
		<p>Your ip: <span id="ip-addr"></span></p>
		<p>Your country: <span id="country"></span></p>
		<div id="image-div"></div>
    	<pre id="message"></pre>
  	</div>
</div>

@section scripts {
	<script>
	$("#results-panel").hide();
	$("#file").on("change", function (event) {
		var t = event.target.files[0];
		prj1551.imageResizer.resize({
			file: t,
			maxWidth: 500,
			maxHeight: 500,
			complete: function (result) {
				$("#image-div").html(result.canvas);
				$("#results-panel").show();
				prj1551.imageResizer.upload({
					url: 'Convert',
					data: result.data,
					mimeType: t.type,
					fileName: t.name,
					formDataName: 'file',
					progressIndicator: '.progress2',
					percentIndicator: '.percent2',
					success: function(data) {
						$('.progress2').hide();
						$('.percent2').hide();
						var obj = jQuery.parseJSON(this.response);
						$('#price').html(obj.prices);
						$('#message').html(obj.message);
						$('#ip-addr').html(obj.ip);
						$('#country').html(obj.country);

						if (obj.ok) {
							$('#price').show();
							$('#message').hide();
						} else {
							$('#price').hide();
							$('#message').show();
						}
					}
				});
			}
		});
	});
	</script>
}